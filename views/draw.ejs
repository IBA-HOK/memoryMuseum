<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ€ã„å‡ºç¾è¡“é¤¨ | ãŠçµµæã</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <!-- Hamburger Menu Button -->
  <button class="hamburger-button" id="hamburgerBtn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay">
    <nav class="menu-nav">
      <ul class="menu-list">
        <li class="menu-item item-orange">
          <a href="/home" class="menu-link">ãƒ›ãƒ¼ãƒ </a>
          <div class="menu-decoration">
            <div class="line"></div>
            <span class="star">â˜…</span>
          </div>
        </li>

        <li class="menu-item item-blue">
          <a href="/atelier/mode" class="menu-link">ã‚¢ãƒˆãƒªã‚¨</a>
          <div class="menu-decoration">
            <div class="line"></div>
            <span class="star">â˜…</span>
          </div>
        </li>

        <li class="menu-item item-pink">
          <a href="/gallery" class="menu-link">å±•ç¤ºå®¤</a>
          <div class="menu-decoration">
            <div class="line"></div>
            <span class="star">â˜…</span>
          </div>
        </li>

        <li class="menu-item item-green">
          <a href="#" class="menu-link" id="logoutLink">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
          <div class="menu-decoration">
            <div class="line"></div>
            <span class="star">â˜…</span>
          </div>
        </li>
      </ul>
    </nav>
  </div>

  <div class="screen-container draw-screen-v2 <%= mode === 'slow' ? 'draw-screen-slow' : (mode === 'quick' ? 'draw-screen-quick' : '') %>" data-shape="<%= shape %>" data-mode="<%= mode %>" data-colors='<%- JSON.stringify(colors) %>' data-color-pool='<%- JSON.stringify(colorPool) %>'>
    <div class="draw-main">
      <div class="draw-header">
        <span><%= mode === "slow" ? "ã˜ã£ãã‚Šãƒ¢ãƒ¼ãƒ‰" : "ã‚µã‚¯ãƒƒã¨ãƒ¢ãƒ¼ãƒ‰" %></span>
        <span><%= username %> ã•ã‚“</span>
        <button type="button" id="undo-btn" class="btn-undo">â†©ï¸ Undo</button>
      </div>
      
      <div class="canvas-section">
        <div id="canvas-area" class="canvas-area <%= shape === 'circle' ? 'circle' : 'square' %>"></div>
      </div>

      <div class="palette-section">
        <div class="palette-header">
          <span>å›³å½¢ãƒ‘ãƒ¬ãƒƒãƒˆ</span>
          <div class="palette-controls">
            <button type="button" id="keep-btn" class="btn-shuffle" disabled>ã‚­ãƒ¼ãƒ—</button>
            <button type="button" id="regen-palette-btn" class="btn-shuffle">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
          </div>
        </div>
        <div id="shape-palette" class="shape-palette"></div>
      </div>

      <div class="draw-controls">
        <button type="button" id="complete-btn" class="btn-primary">å®Œæˆ</button>
      </div>

      <% if (mode === "slow") { %>
      <button type="button" id="color-picker-btn" class="floating-color-btn" aria-haspopup="dialog" aria-controls="color-modal" aria-label="è‰²ã‚’é¸ã¶">ğŸ¨</button>
      <div id="color-modal" class="color-modal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="color-modal__backdrop" data-dismiss="color-modal"></div>
        <div class="color-modal__panel">
          <div class="color-modal__header">
            <span>è‰²ã‚’é¸ã¶</span>
            <button type="button" id="color-modal-close" class="color-modal__close" aria-label="é–‰ã˜ã‚‹">é–‰ã˜ã‚‹</button>
          </div>
          <div id="color-modal-grid" class="color-modal__grid"></div>
        </div>
      </div>
      <% } %>

      <div id="size-control" class="size-control">
        <div class="rotation-control">
          <label for="rotation-slider">å›è»¢</label>
          <input id="rotation-slider" type="range" min="0" max="360" value="0">
          <span id="rotation-value" class="value-display">0</span>Â°
        </div>
        <div class="size-control-inner">
          <label for="size-slider">ã‚µã‚¤ã‚º</label>
          <input id="size-slider" type="range" min="20" max="300" value="80">
          <span id="size-value" class="value-display">80</span>px
        </div>
        <button type="button" id="size-confirm-btn" class="btn-secondary">æ±ºå®š</button>
      </div>

      <div class="save-status" id="save-status"></div>
    </div>

    <% if (mode === "quick") { %>
    <div id="quick-color-palette" class="quick-color-bar" aria-label="è‰²ã‚’é¸ã¶"></div>
    <% } %>
  </div>
  <script src="/js/draw.js" defer></script>
  <script>
    // Hamburger menu toggle
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const menuOverlay = document.getElementById('menuOverlay');
    const logoutLink = document.getElementById('logoutLink');

    hamburgerBtn.addEventListener('click', () => {
      hamburgerBtn.classList.toggle('active');
      menuOverlay.classList.toggle('active');
    });

    // Close menu when clicking outside
    menuOverlay.addEventListener('click', (e) => {
      if (e.target === menuOverlay) {
        hamburgerBtn.classList.remove('active');
        menuOverlay.classList.remove('active');
      }
    });

    // Logout functionality
    logoutLink.addEventListener('click', async (event) => {
      event.preventDefault();
      try {
        const response = await fetch('/api/logout', { method: 'POST' });
        if (response.ok || response.status === 401) {
          window.location.href = '/login';
          return;
        }
      } catch (err) {
        console.error('Logout failed:', err);
      }
      alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
    });
  </script>
</body>
</html>
